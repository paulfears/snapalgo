"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.evalBundle = void 0;
const path_1 = require("path");
const child_process_1 = require("child_process");
const fs_1 = require("./fs");
const WORKER_PATH = (0, path_1.join)(__dirname, 'eval-worker.js');
/**
 * Spawn a new process to run the provided bundle in.
 *
 * @param bundlePath - The path to the bundle to run.
 * @returns `null` if the worker ran successfully.
 * @throws If the worker failed to run successfully.
 */
async function evalBundle(bundlePath) {
    await (0, fs_1.validateFilePath)(bundlePath);
    return new Promise((resolve, reject) => {
        const worker = (0, child_process_1.fork)(WORKER_PATH, [bundlePath]);
        worker.on('exit', (exitCode) => {
            if (exitCode === 0) {
                return resolve(null);
            }
            return reject(new Error(`Process exited with non-zero exit code: ${exitCode}`));
        });
    });
}
exports.evalBundle = evalBundle;
//# sourceMappingURL=eval.js.map